<h1>Overview</h1>

<% if (statistics_level == 'fine') { %>
<div class="section">
<h2>Message Rates</h2>
<div class="hider updatable">
<%= message_rates(overview.message_stats) %>
<span class="br"></span>
</div>
</div>
<% } %>

<div class="section">
<h2>RabbitMQ Nodes</h2>
<div class="hider updatable">
<table class="list">
  <tr>
    <th>Name</th>
    <th>Mnesia Storage</th>
    <th>OS Pid</th>
    <th>
      File Descriptors
      <sub>(used / available)</sub>
    </th>
    <th>
      Erlang Processes
      <sub>(used / available)</sub>
    </th>
    <th>
      Memory
      <sub>(used / high watermark)</sub>
    </th>
    <th>Statistics</th>
  </tr>
<%
for (var i = 0; i < nodes.length; i++) {
    var node = nodes[i];
%>
   <tr<%= alt_rows(i)%>>
     <td>
       <%= node.name %>
     </td>
     <td class="c">
       <%= node.type %>
     </td>
<% if (node.running) { %>
     <td class="c"><%= node.os_pid %></td>
     <td class="status">
       <div class="<%= fmt_color(node.fd_used / node.fd_total) %>">
         <%= node.fd_used %> / <%= node.fd_total %>
       </div>
     </td>
     <td class="status">
       <div class="<%= fmt_color(node.proc_used / node.proc_total) %>">
         <%= node.proc_used %> / <%= node.proc_total %>
       </div>
     </td>
     <td class="status">
<% if (node.mem_total != 'memory_monitoring_disabled') { %>
       <div class="<%= fmt_color(node.mem_used / node.mem_limit) %>">
         <%= fmt_bytes(node.mem_used) %> / <%= fmt_bytes(node.mem_limit) %>
       </div>
<% } else { %>
       <%= fmt_bytes(node.mem_used) %>
<% } %>
     </td>
     <td class="c">
       <%= node.statistics_level %>
     </td>
<% } else { %>
     <td class="status" colspan="5">
       <div class="red">
         Node not running
       </div>
     </td>
   </tr>
<% } %>
<% } %>
</table>

<p>
  Management plugin running on node <b><%= overview.node %></b>
</p>

</div>
</div>

<div class="section">
<h2>Listening on</h2>
<div class="hider updatable">
<table class="list">
  <tr>
    <th>Host</th>
    <th>Port</th>
  </tr>
<%
for (var i = 0; i < overview.listeners.length; i++) {
    var listener = overview.listeners[i];
%>
   <tr<%= alt_rows(i)%>>
     <td>
       <%= listener.host %>
       <sub><%= listener.node %></sub>
     </td>
     <td>
       <%= listener.port %>
       <sub><%= listener.protocol %></sub>
     </td>
   </tr>
<% } %>
</table>
</div>
</div>

<div class="section-hidden">
<h2>Applications</h2>
<div class="hider">
<table class="list">
  <thead>
    <tr>
      <th>Name</th>
      <th>Version</th>
    </tr>
  </thead>
  <tbody>
    <% for (var i = 0; i < applications.length; i++) { %>
       <tr<%= alt_rows(i)%>>
         <td><abbr title="<%= applications[i].description %>"><%= applications[i].name %></abbr></td>
         <td><%= applications[i].version %></td>
       </tr>
    <% } %>
  </tbody>
</table>
<span class="br"></span>
</div>
</div>

<div class="section-hidden administrator-only">
<h2>Import / Export Configuration</h2>
<div class="hider">
  <p>
    The configuration consists of users, virtual hosts, permissions,
    exchanges, queues and bindings. It does not include the contents of
    queues.
  </p>
  <form action="/api/all-configuration" method="post" enctype="multipart/form-data">
    <table class="two-col-layout">
      <tr>
        <td>
          <h3>Export</h3>
          <p>
            <label for="download-filename">Filename for download:</label><br/>
            <input type="text" id="download-filename" value="<%= fmt_download_filename(overview.node) %>" class="wide" />
          </p>
          <p>
            Note: exclusive queues will not be exported.
          </p>
        </td>
        <td>
          <h3>Import</h3>
          <p>
            <label>Configuration file:</label><br/>
            <input type="file" name="file"/>
          </p>
          <p>
            Note: The configuration that is imported will be merged with
            the current configuration. If an error occurs during import,
            any configuration changes made will not be rolled back.
          </p>
        </td>
      </tr>
      <tr>
        <td>
          <p>
            <button id="download-configuration">Download broker configuration</button>
          </p>
        </td>
        <td>
          <p>
            <input type="hidden" name="redirect" value="/mgmt/#/import-succeeded"/>
            <input type="submit" value="Upload broker configuration"/>
          </p>
        </td>
      </tr>
    </table>
  </form>
</div>
</div>

<% if (overview.statistics_level != 'fine') { %>
<div class="section-hidden">
<h2>Message Rates Disabled</h2>
<div class="hider">
<p>
  The statistics level in this RabbitMQ server is currently set to
  <code><%= overview.statistics_level %></code>. Message rates are therefore
  disabled.
</p>
<p>
  To re-enable message rates, edit your configuration file and either
  set <code>collect_statistics</code> to <code>fine</code> in
  the <code>rabbit</code> application, or
  set <code>force_fine_statistics</code> to <code>true</code> in
  the <code>rabbit_management</code> application
</p>
<span class="br"></span>
</div>
</div>
<% } %>
